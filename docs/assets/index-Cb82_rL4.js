var m={},T={},E;function k(){if(E)return T;E=1,Object.defineProperty(T,"__esModule",{value:!0}),T.TimeClock=void 0;const a={interval:1e3};let d=class{constructor(b=a){this.clockOptions=b,this.isTiming=!1,this.nextExecuteTime=0,this.removeListener=r=>{const f=this.listeners.findIndex(s=>s===r);f>=0&&this.listeners.splice(f,1)},this.addListener=r=>{this.listeners.push(r)},this.subscribe=r=>(this.addListener(r),()=>this.unSubscribe(r)),this.unSubscribe=r=>{this.removeListener(r),this.listeners.length===0&&(this.isTiming=!1,this.clearTimeout())},this.startTiming=()=>{this.isTiming||this.listeners.length===0||(this.nextExecuteTime=Date.now()+this.options.interval,this.isTiming=!0,this.schedule())},this.stopTiming=()=>{this.isTiming=!1,this.clearTimeout()},this.notify=()=>{if(!this.isTiming)return;const{listeners:r}=this,f=Date.now();r.forEach(s=>{s.call(null,{value:f,isOver:!1})})},this.schedule=()=>{const{interval:r}=this.options,f=Date.now();let s=this.nextExecuteTime-f;if(s<0){this.clearTimeout(),this.nextExecuteTime+=r,this.notify(),this.isTiming&&this.schedule();return}this.ticket=setTimeout(()=>{this.nextExecuteTime+=r,this.notify(),this.isTiming&&this.schedule()},s)},this.clearTimeout=()=>{this.ticket&&clearTimeout(this.ticket),this.ticket=void 0},this.hasListener=r=>this.listeners.includes(r),this.listeners=[]}get options(){return Object.assign({},this.clockOptions)}};return T.TimeClock=d,T}var _={},M={},D;function B(){return D||(D=1,Object.defineProperty(M,"__esModule",{value:!0}),M.DefaultSubscribeOptions=void 0,M.DefaultSubscribeOptions={start:60*1e3,end:0,autoUnsubscribe:!0,step:1e3,name:"",isDecrease:!0,notifyOnSubscribe:!0}),M}var p={},q;function F(){if(q)return p;q=1,Object.defineProperty(p,"__esModule",{value:!0}),p.noop=void 0,p.isObject=h,p.isFunction=b,p.hasown=r,p.isTimeClock=f;const a=Object.prototype.hasOwnProperty,d=()=>{};p.noop=d;function h(s){return s!==null&&typeof s=="object"}function b(s){return typeof s=="function"}function r(s,n){return a.call(s,n)}function f(s){return h(s)?b(s.subscribe)&&b(s.unSubscribe)&&b(s.startTiming)&&b(s.stopTiming)&&r(s,"isTiming")&&r(s,"hasListener"):!1}return p}var x={},j;function A(){if(j)return x;j=1,Object.defineProperty(x,"__esModule",{value:!0}),x.createInstance=a;function a(d="uuid"){let h=0;return function(){return h++,`${d}-${h}`}}return x.default=a(),x}var I;function w(){if(I)return _;I=1;var a=_.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(_,"__esModule",{value:!0}),_.CountManger=void 0;const d=B(),h=k(),b=F(),r=a(A());let f=class{constructor(n){this.unSubscribeClock=b.noop,this.subscribersMap=new Map,this.getSubscriberInitValue=t=>{const{start:i,isDecrease:e,step:u,end:c}=t,g=i,o=e?i-u:i+u,l=e?c>=i:i>=c;return{value:g,nextStepValue:o,isOver:l,end:c,start:i}},this.onUpdate=()=>{const t=this.getEnabledSubscribers();for(let i=0;i<t.length;i++){const e=t[i],{isOver:u,newValue:c,executable:g,nextStepValue:o}=this.getExecuteInfo(e);if(u||(e.value=c,!g))continue;e.nextStepValue=o;const{listeners:l}=e,O=[...l];let S=this.isOver(e);S&&this.clearIsOverSubscribe(),O.forEach(v=>v.call(null,{value:e.value,isOver:S}))}},this.subScribe=(t,i={})=>{const e=i.key||(0,r.default)(),u=Object.assign(Object.assign({},i),{key:e});this.registerSubscriber(t,u);const c=this;return Object.freeze({unSubscribe:()=>this.unSubscribe(t,e),key:e,startListening:(o=!1)=>{const l=this.getSubscriber(e);if(!l)throw new Error(`key为${e}的订阅已经被取消`);const O=this.isOver(l);if(l.enabled&&!O)return console.warn("已经处于监听状态，无需重复调用");const{value:S,nextStepValue:v}=this.getSubscriberInitValue(l);l.enabled=!0,l.value=S,l.nextStepValue=v,this.check()},get isOver(){const o=c.getSubscriber(e);return o?c.isOver(o):!0},get enabled(){const o=c.getSubscriber(e);return o?o.enabled:!1},get isValid(){return c.hasSubscriber(e,t)}})},this.registerSubscriber=(t,i={})=>{const{key:e=(0,r.default)(),start:u=60*1e3,end:c=0,autoUnsubscribe:g=!0,step:o=1e3,name:l="",isDecrease:O=!0,notifyOnSubscribe:S=!0}=Object.assign({},d.DefaultSubscribeOptions,i);let v=this.subscribersMap.get(e);const{value:V,nextStepValue:R,isOver:$}=this.getSubscriberInitValue({start:u,end:c,step:o,isDecrease:O});if(v||(v={start:u,end:c,step:o,value:V,nextStepValue:R,listeners:[],autoUnsubscribe:g,key:e,name:l,isDecrease:O,notifyOnSubscribe:S,enabled:!1},this.subscribersMap.set(e,v)),v.listeners.push(t),S){const z=this.getSubScribeValue(e)||V;t.call(null,{value:z,isOver:$})}},this.getSubScribeValue=t=>{const i=this.getSubscriber(t);if(!i)return;const e=i.listeners;if(e.length!==0&&e.length>=1)return i.value},this.check=()=>{this.hasEnabledSubscribers()&&(this.clock.hasListener(this.onUpdate)||(this.unSubscribeClock=this.clock.subscribe(this.onUpdate)),!this.clock.isTiming&&this.clock.startTiming())},this.unSubscribe=(t,i)=>{const e=this.subscribersMap.get(i);if(!e)return;const u=e.listeners.findIndex(g=>g===t);if(u<0)return;e.listeners.splice(u,1),e.listeners.length===0&&this.subscribersMap.delete(i),this.hasEnabledSubscribers()||this.unSubscribeClock()},this.getSubscribers=()=>[...this.subscribersMap.values()].map(t=>Object.freeze(t)),this.hasSubscriber=(t,i)=>{const e=this.subscribersMap.get(t);return e?e.listeners.includes(i):!1},this.getSubscriber=t=>this.subscribersMap.get(t),this.getEnabledSubscribers=()=>Array.from(this.subscribersMap.values()).filter(t=>t.enabled),this.hasEnabledSubscribers=()=>this.getEnabledSubscribers().length>0,this.clock=(0,b.isTimeClock)(n)?n:new h.TimeClock(n)}isOver(n){const t=!!n.isDecrease,{value:i}=n;return t?i<=n.end:i>=n.end}getExecuteInfo(n){const t=this.clock.options.interval,i=!!n.isDecrease,{value:e,nextStepValue:u,step:c}=n,g=this.isOver(n);if(i){const l=n.value-t;return{isOver:g,oldValue:e,newValue:l,executable:e>n.nextStepValue&&l<=n.nextStepValue,nextStepValue:u-c}}const o=n.value+t;return{isOver:g,oldValue:e,newValue:o,executable:e<n.nextStepValue&&o>=n.nextStepValue,nextStepValue:u+c}}clearIsOverSubscribe(){const n=this.getEnabledSubscribers();for(let t=0;t<n.length;t++){const i=n[t];if(this.getExecuteInfo(i).isOver&&i.autoUnsubscribe)for(let u=i.listeners.length-1;u>=0;u--){const c=i.listeners[u];this.unSubscribe(c,i.key)}}}};return _.CountManger=f,_}var C={},P;function W(){if(P)return C;P=1,Object.defineProperty(C,"__esModule",{value:!0}),C.countManager=void 0;const a=k(),d=w(),h=new a.TimeClock;return C.countManager=new d.CountManger(h),C}var y={},U;function G(){return U||(U=1,Object.defineProperty(y,"__esModule",{value:!0})),y}var L;function H(){return L||(L=1,function(a){var d=m.__createBinding||(Object.create?function(s,n,t,i){i===void 0&&(i=t);var e=Object.getOwnPropertyDescriptor(n,t);(!e||("get"in e?!n.__esModule:e.writable||e.configurable))&&(e={enumerable:!0,get:function(){return n[t]}}),Object.defineProperty(s,i,e)}:function(s,n,t,i){i===void 0&&(i=t),s[i]=n[t]}),h=m.__exportStar||function(s,n){for(var t in s)t!=="default"&&!Object.prototype.hasOwnProperty.call(n,t)&&d(n,s,t)};Object.defineProperty(a,"__esModule",{value:!0}),a.createCountDownManger=f;const b=k(),r=w();h(k(),a),h(w(),a),h(W(),a),h(G(),a);function f(s){const n=new b.TimeClock(s);return new r.CountManger(n)}}(m)),m}var N=H();export{N as d};

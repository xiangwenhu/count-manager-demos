var S={},T={},D;function x(){if(D)return T;D=1,Object.defineProperty(T,"__esModule",{value:!0}),T.TimeClock=void 0;const o={interval:1e3};let d=class{constructor(b=o){this.clockOptions=b,this.isTiming=!1,this.nextExecuteTime=0,this.removeListener=r=>{const f=this.listeners.findIndex(s=>s===r);f>=0&&this.listeners.splice(f,1)},this.addListener=r=>{this.listeners.push(r)},this.subscribe=r=>(this.addListener(r),()=>this.unSubscribe(r)),this.unSubscribe=r=>{this.removeListener(r),this.listeners.length===0&&(this.isTiming=!1,this.clearTimeout())},this.startTiming=()=>{this.isTiming||this.listeners.length===0||(this.nextExecuteTime=this.now+this.options.interval,this.isTiming=!0,this.schedule())},this.stopTiming=()=>{this.isTiming=!1,this.clearTimeout()},this.notify=()=>{if(!this.isTiming)return;const{listeners:r}=this,f=this.now;r.forEach(s=>{s.call(null,{value:f,isOver:!1})})},this.schedule=()=>{const{interval:r}=this.options,f=performance.now();let s=this.nextExecuteTime-f;if(s<0){this.clearTimeout(),this.nextExecuteTime+=r,this.notify(),this.isTiming&&this.schedule();return}this.ticket=setTimeout(()=>{this.nextExecuteTime+=r,this.notify(),this.isTiming&&this.schedule()},s)},this.clearTimeout=()=>{this.ticket&&clearTimeout(this.ticket),this.ticket=void 0},this.hasListener=r=>this.listeners.includes(r),this.listeners=[]}get options(){return Object.assign({},this.clockOptions)}get now(){return performance.now()}};return T.TimeClock=d,T}var O={},k={},j;function B(){return j||(j=1,Object.defineProperty(k,"__esModule",{value:!0}),k.DefaultSubscribeOptions=void 0,k.DefaultSubscribeOptions={start:60*1e3,end:0,autoUnsubscribe:!0,step:1e3,name:"",isDecrease:!0,notifyOnSubscribe:!0}),k}var p={},q;function A(){if(q)return p;q=1,Object.defineProperty(p,"__esModule",{value:!0}),p.noop=void 0,p.isObject=h,p.isFunction=b,p.hasown=r,p.isTimeClock=f;const o=Object.prototype.hasOwnProperty,d=()=>{};p.noop=d;function h(s){return s!==null&&typeof s=="object"}function b(s){return typeof s=="function"}function r(s,n){return o.call(s,n)}function f(s){return h(s)?b(s.subscribe)&&b(s.unSubscribe)&&b(s.startTiming)&&b(s.stopTiming)&&r(s,"isTiming")&&r(s,"hasListener"):!1}return p}var M={},I;function W(){if(I)return M;I=1,Object.defineProperty(M,"__esModule",{value:!0}),M.createInstance=o;function o(d="uuid"){let h=0;return function(){return h++,`${d}-${h}`}}return M.default=o(),M}var P;function V(){if(P)return O;P=1;var o=O&&O.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(O,"__esModule",{value:!0}),O.CountManger=void 0;const d=B(),h=x(),b=A(),r=o(W());let f=class{constructor(n){this.unSubscribeClock=b.noop,this.subscribersMap=new Map,this.getClockFactor=t=>{const i=this.clock.options.interval;let e=i;if(typeof t.clockFactor=="number"&&(e=t.clockFactor),typeof t.clockFactor=="function"){const u=t.clockFactor.call(Object.assign({},t),i);typeof u=="number"&&(e=u)}return Math.ceil(e)},this.getSubscriberInitValue=t=>{const{start:i,isDecrease:e,step:u,end:c}=t,g=i,a=e?i-u:i+u,l=e?c>=i:i>=c;return{value:g,nextStepValue:a,isOver:l,end:c,start:i}},this.onUpdate=()=>{const t=this.getEnabledSubscribers();for(let i=0;i<t.length;i++){const e=t[i],{isOver:u,newValue:c,executable:g,nextStepValue:a}=this.getExecuteInfo(e);if(u||(e.value=c,!g))continue;e.nextStepValue=a;const{listeners:l}=e,m=[...l];let v=this.isOver(e);v&&this.clearIsOverSubscribe(),m.forEach(_=>_.call(null,{value:e.value,isOver:v}))}},this.subScribe=(t,i={})=>{const e=i.key||(0,r.default)(),u=Object.assign(Object.assign({},i),{key:e});this.registerSubscriber(t,u);const c=this;return Object.freeze({unSubscribe:()=>this.unSubscribe(t,e),key:e,startListening:(a=!1)=>{const l=this.getSubscriber(e);if(!l)throw new Error(`key为${e}的订阅已经被取消`);const m=this.isOver(l);if(l.enabled&&!m)return console.warn("已经处于监听状态，无需重复调用");const{value:v,nextStepValue:_}=this.getSubscriberInitValue(l);l.enabled=!0,l.value=v,l.nextStepValue=_,this.check()},get isOver(){const a=c.getSubscriber(e);return a?c.isOver(a):!0},get enabled(){const a=c.getSubscriber(e);return a?a.enabled:!1},get isValid(){return c.hasSubscriber(e,t)}})},this.registerSubscriber=(t,i={})=>{const{key:e=(0,r.default)(),start:u=60*1e3,end:c=0,autoUnsubscribe:g=!0,step:a=1e3,name:l="",isDecrease:m=!0,notifyOnSubscribe:v=!0,clockFactor:_=this.clock.options.interval}=Object.assign({},d.DefaultSubscribeOptions,i);let y=this.subscribersMap.get(e);const{value:E,nextStepValue:R,isOver:$}=this.getSubscriberInitValue({start:u,end:c,step:a,isDecrease:m});if(y||(y={start:u,end:c,step:a,value:E,nextStepValue:R,listeners:[],autoUnsubscribe:g,key:e,name:l,isDecrease:m,notifyOnSubscribe:v,enabled:!1,clockFactor:_},this.subscribersMap.set(e,y)),y.listeners.push(t),v){const z=this.getSubScribeValue(e)||E;t.call(null,{value:z,isOver:$})}},this.getSubScribeValue=t=>{const i=this.getSubscriber(t);if(!i)return;const e=i.listeners;if(e.length!==0&&e.length>=1)return i.value},this.check=()=>{this.hasEnabledSubscribers()&&(this.clock.hasListener(this.onUpdate)||(this.unSubscribeClock=this.clock.subscribe(this.onUpdate)),!this.clock.isTiming&&this.clock.startTiming())},this.unSubscribe=(t,i)=>{const e=this.subscribersMap.get(i);if(!e)return;const u=e.listeners.findIndex(g=>g===t);if(u<0)return;e.listeners.splice(u,1),e.listeners.length===0&&this.subscribersMap.delete(i),this.hasEnabledSubscribers()||this.unSubscribeClock()},this.getSubscribers=()=>[...this.subscribersMap.values()].map(t=>Object.freeze(t)),this.hasSubscriber=(t,i)=>{const e=this.subscribersMap.get(t);return e?e.listeners.includes(i):!1},this.getSubscriber=t=>this.subscribersMap.get(t),this.getEnabledSubscribers=()=>Array.from(this.subscribersMap.values()).filter(t=>t.enabled),this.hasEnabledSubscribers=()=>this.getEnabledSubscribers().length>0,this.clock=(0,b.isTimeClock)(n)?n:new h.TimeClock(n)}isOver(n){const t=!!n.isDecrease,{value:i}=n;return t?i<=n.end:i>=n.end}getExecuteInfo(n){const t=this.getClockFactor(n),i=!!n.isDecrease,{value:e,nextStepValue:u,step:c}=n,g=this.isOver(n);if(i){const l=n.value-t;return{isOver:g,oldValue:e,newValue:l,executable:e>n.nextStepValue&&l<=n.nextStepValue,nextStepValue:u-c}}const a=n.value+t;return{isOver:g,oldValue:e,newValue:a,executable:e<n.nextStepValue&&a>=n.nextStepValue,nextStepValue:u+c}}clearIsOverSubscribe(){const n=this.getEnabledSubscribers();for(let t=0;t<n.length;t++){const i=n[t];if(this.getExecuteInfo(i).isOver&&i.autoUnsubscribe)for(let u=i.listeners.length-1;u>=0;u--){const c=i.listeners[u];this.unSubscribe(c,i.key)}}}};return O.CountManger=f,O}var C={},F;function G(){if(F)return C;F=1,Object.defineProperty(C,"__esModule",{value:!0}),C.countManager=void 0;const o=x(),d=V(),h=new o.TimeClock;return C.countManager=new d.CountManger(h),C}var w={},U;function H(){return U||(U=1,Object.defineProperty(w,"__esModule",{value:!0})),w}var L;function J(){return L||(L=1,function(o){var d=S&&S.__createBinding||(Object.create?function(s,n,t,i){i===void 0&&(i=t);var e=Object.getOwnPropertyDescriptor(n,t);(!e||("get"in e?!n.__esModule:e.writable||e.configurable))&&(e={enumerable:!0,get:function(){return n[t]}}),Object.defineProperty(s,i,e)}:function(s,n,t,i){i===void 0&&(i=t),s[i]=n[t]}),h=S&&S.__exportStar||function(s,n){for(var t in s)t!=="default"&&!Object.prototype.hasOwnProperty.call(n,t)&&d(n,s,t)};Object.defineProperty(o,"__esModule",{value:!0}),o.createCountDownManger=f;const b=x(),r=V();h(x(),o),h(V(),o),h(G(),o),h(H(),o);function f(s){const n=new b.TimeClock(s);return new r.CountManger(n)}}(S)),S}var Q=J();export{Q as d};
